plugins {
    id "org.springframework.boot" version "${springVersion}"
    id "io.spring.dependency-management" version "${springDependencyManagement}"
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

dependencies {
    implementation project(':domain')
    implementation project(':application')
    implementation 'org.springframework.boot:spring-boot-starter-web'

    implementation "org.mapstruct:mapstruct:${mapstructVersion}", "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.mapstruct:mapstruct-processor:${mapstructVersion}", "org.projectlombok:lombok:${lombokVersion}", "org.projectlombok:lombok-mapstruct-binding:${lombokMapstructBindingVersion}"

    compileOnly 'org.projectlombok:lombok'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

bootJar {
    enabled = false
}

jar {
    enabled = true
}

task copyMapStructFile(type: Copy) {
    from 'build/generated/sources/annotationProcessor/java/main'
    into 'src/main/java'
}

task deleteMapStructFile(type: Delete) {
  delete fileTree('src/main/java/com/pumapunku/pet/api/mapper/') { include '**/*Impl.java' }
}

jar.dependsOn deleteMapStructFile

task myJar {
    dependsOn 'clean'
    dependsOn 'deleteMapStructFile'
    dependsOn 'jar'
    dependsOn 'copyMapStructFile'
    tasks.findByName('deleteMapStructFile').mustRunAfter 'clean'
    tasks.findByName('jar').mustRunAfter 'deleteMapStructFile'
    tasks.findByName('copyMapStructFile').mustRunAfter 'jar'
}